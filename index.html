<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>éƒ½é“åºœçœŒå½¢å½“ã¦ã‚²ãƒ¼ãƒ </title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
body {
  font-family:'Roboto',sans-serif;
  text-align:center;
  margin:0;
  padding:20px;
  min-height:100vh;
  background: linear-gradient(135deg,#56ccf2,#2f80ed);
  color:#fff;
}
h2 { text-shadow:2px 2px 6px rgba(0,0,0,0.3); }
button {
  background-color:#ffe066;
  color:#222;
  border:none;
  border-radius:12px;
  padding:14px 24px;
  font-size:18px;
  margin:10px auto;
  cursor:pointer;
  transition:all 0.2s;
  display:block;
  width:100%;
  max-width:300px;
  box-sizing:border-box;
}
button:hover { transform:scale(1.05); box-shadow:0 0 15px #ffe066; }
#prefImg { width:300px; height:300px; object-fit:contain; border:3px solid #fff; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.2); margin:20px auto; }
#hint { width:100%; max-width:300px; min-height:50px; background:#fff; color:#222; border-radius:8px; display:none; margin:10px auto; padding:10px; font-weight:bold; }
#result { width:100%; max-width:300px; min-height:40px; margin:10px auto; font-size:18px; font-weight:bold; }
input { width:100%; max-width:300px; padding:12px; border-radius:8px; border:none; margin:10px auto; font-size:18px; box-sizing:border-box; }
.correct { color:#0f0; animation:pop 0.3s; }
.wrong { color:#ff3b3b; animation:shake 0.3s; }
#score { margin:10px auto; font-size:16px; white-space: pre-line; font-weight:bold; }

@keyframes pop { 0%{transform:scale(0.5);} 100%{transform:scale(1);} }
@keyframes shake { 0%,100%{transform:translateX(0);} 20%,60%{transform:translateX(-5px);} 40%,80%{transform:translateX(5px);} }

#modeSelect,#gameArea,#resultScreen { display:flex; flex-direction:column; align-items:center; }
#gameArea,#modeSelect { max-width:350px; margin:0 auto; }
#gameArea { background:rgba(255,255,255,0.85); border-radius:16px; padding:20px; color:#222; }
#resultScreen { max-width:350px; margin:0 auto; color:#fff; }

/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; opacity:0; transition: opacity 0.3s ease; }
.modal.show { display:flex; opacity:1; }
.modal-content { background:#fff; color:#222; padding:20px; border-radius:12px; max-width:450px; width:90%; text-align:center; box-shadow:0 5px 20px rgba(0,0,0,0.3); transform: translateY(-30px); transition: transform 0.3s ease; }
.modal.show .modal-content { transform: translateY(0); }
#regionTable { width:100%; border-collapse:collapse; margin-top:15px; }
#regionTable th, #regionTable td { border:1px solid #ccc; padding:8px; }
#regionTable th { background:#f0f0f0; }
</style>
</head>
<body>

<div id="modeSelect">
  <h2>ãƒ¢ãƒ¼ãƒ‰ã‚’é¸ã‚“ã§ã­</h2>
  <button onclick="startMode('tohoku')">æ±åŒ—åœ°æ–¹ï¼ˆåŒ—æµ·é“å«ã‚€ï¼‰</button>
  <button onclick="startMode('kanto')">é–¢æ±åœ°æ–¹</button>
  <button onclick="startMode('chubu')">ä¸­éƒ¨åœ°æ–¹</button>
  <button onclick="startMode('kinki')">è¿‘ç•¿åœ°æ–¹</button>
  <button onclick="startMode('chugoku')">ä¸­å›½åœ°æ–¹</button>
  <button onclick="startMode('shikoku')">å››å›½åœ°æ–¹</button>
  <button onclick="startMode('kyushu')">ä¹å·åœ°æ–¹</button>
  <button onclick="startMode('all')">47éƒ½é“åºœçœŒ</button>
  <button onclick="startKanjiMode()">æ¼¢å­—4æŠãƒ¢ãƒ¼ãƒ‰</button>
</div>

<div id="gameArea" style="display:none;">
  <img id="prefImg" src="" alt="éƒ½é“åºœçœŒã®å½¢">
  <div id="result"></div>
  <input type="text" id="guess" placeholder="éƒ½é“åºœçœŒåã‚’å…¥åŠ›">
  <button id="checkBtn">ç­”ãˆåˆã‚ã›</button>
  <button id="hintBtn">ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹</button>
  <div id="hint"></div>
  <button id="backBtn">ãƒ¢ãƒ¼ãƒ‰é¸æŠã«æˆ»ã‚‹</button>
  <p id="score"></p>
</div>

<div id="resultScreen" style="display:none;">
  <h2>ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ğŸ‰</h2>
  <p id="date"></p>
  <p id="finalScore"></p>
  <button onclick="openModal()">ğŸ“Š åœ°æ–¹åˆ¥æ­£è§£ã‚’è¦‹ã‚‹</button>
  <button onclick="takeScreenshot()">ğŸ“¸ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ</button>
  <button onclick="shareOnLINE()">ğŸ’¬ LINEã§ã‚·ã‚§ã‚¢</button>
  <button onclick="backToMenu()">â¬…ï¸ ãƒ¢ãƒ¼ãƒ‰é¸æŠã«æˆ»ã‚‹</button>
</div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="detailModal" class="modal">
  <div class="modal-content">
    <h3>åœ°æ–¹åˆ¥ã®æ­£è§£æ•°</h3>
    <table id="regionTable">
      <thead>
        <tr><th>åœ°æ–¹</th><th>æ­£è§£æ•°</th><th>æ­£è§£ç‡</th></tr>
      </thead>
      <tbody id="regionDetails"></tbody>
    </table>
    <button onclick="closeModal()">é–‰ã˜ã‚‹</button>
  </div>
</div>

 <!-- æ¼¢å­—ï¼”æŠ -->
<div id="kanjiModeArea" class="gameAreaStyle" style="display:none;">
  <img id="kanjiPrefImg" class="gameImage" src="" alt="éƒ½é“åºœçœŒã®å½¢">

  <div id="kanjiButtons" style="width:100%; display:flex; flex-direction:column; gap:10px; margin:10px 0;"></div>

  <div id="kanjiResult" style="min-height:40px; font-size:18px; font-weight:bold; margin:10px 0;"></div>

  <button id="kanjiBackBtn" class="gameButton">ãƒ¢ãƒ¼ãƒ‰é¸æŠã«æˆ»ã‚‹</button>
</div>
  
<script>
// éƒ½é“åºœçœŒãƒ‡ãƒ¼ã‚¿ï¼ˆ47éƒ½é“åºœçœŒã‚µãƒ³ãƒ—ãƒ«ï¼‰
const prefectures=[
{name:'åŒ—æµ·é“', img:'hokkaido.png', region:'æ±åŒ—åœ°æ–¹', hint:'æœ­å¹Œå¸‚'},
{name:'é’æ£®çœŒ', img:'aomori.png', region:'æ±åŒ—åœ°æ–¹', hint:'é’æ£®å¸‚'},
{name:'å²©æ‰‹çœŒ', img:'iwate.png', region:'æ±åŒ—åœ°æ–¹', hint:'ç››å²¡å¸‚'},
{name:'å®®åŸçœŒ', img:'miyagi.png', region:'æ±åŒ—åœ°æ–¹', hint:'ä»™å°å¸‚'},
{name:'ç§‹ç”°çœŒ', img:'akita.png', region:'æ±åŒ—åœ°æ–¹', hint:'ç§‹ç”°å¸‚'},
{name:'å±±å½¢çœŒ', img:'yamagata.png', region:'æ±åŒ—åœ°æ–¹', hint:'å±±å½¢å¸‚'},
{name:'ç¦å³¶çœŒ', img:'fukushima.png', region:'æ±åŒ—åœ°æ–¹', hint:'ç¦å³¶å¸‚'},
{name:'èŒ¨åŸçœŒ', img:'ibaraki.png', region:'é–¢æ±åœ°æ–¹', hint:'æ°´æˆ¸å¸‚'},
{name:'æ ƒæœ¨çœŒ', img:'tochigi.png', region:'é–¢æ±åœ°æ–¹', hint:'å®‡éƒ½å®®å¸‚'},
{name:'ç¾¤é¦¬çœŒ', img:'gunma.png', region:'é–¢æ±åœ°æ–¹', hint:'å‰æ©‹å¸‚'},
{name:'åŸ¼ç‰çœŒ', img:'saitama.png', region:'é–¢æ±åœ°æ–¹', hint:'ã•ã„ãŸã¾å¸‚'},
{name:'åƒè‘‰çœŒ', img:'chiba.png', region:'é–¢æ±åœ°æ–¹', hint:'åƒè‘‰å¸‚'},
{name:'æ±äº¬éƒ½', img:'tokyo.png', region:'é–¢æ±åœ°æ–¹', hint:'æ–°å®¿åŒº'},
{name:'ç¥å¥ˆå·çœŒ', img:'kanagawa.png', region:'é–¢æ±åœ°æ–¹', hint:'æ¨ªæµœå¸‚'},
{name:'æ–°æ½ŸçœŒ', img:'niigata.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'æ–°æ½Ÿå¸‚'},
{name:'å¯Œå±±çœŒ', img:'toyama.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'å¯Œå±±å¸‚'},
{name:'çŸ³å·çœŒ', img:'ishikawa.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'é‡‘æ²¢å¸‚'},
{name:'ç¦äº•çœŒ', img:'fukui.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'ç¦äº•å¸‚'},
{name:'å±±æ¢¨çœŒ', img:'yamanashi.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'ç”²åºœå¸‚'},
{name:'é•·é‡çœŒ', img:'nagano.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'é•·é‡å¸‚'},
{name:'å²é˜œçœŒ', img:'gifu.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'å²é˜œå¸‚'},
{name:'é™å²¡çœŒ', img:'shizuoka.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'é™å²¡å¸‚'},
{name:'æ„›çŸ¥çœŒ', img:'aichi.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'åå¤å±‹å¸‚'},
{name:'ä¸‰é‡çœŒ', img:'mie.png', region:'è¿‘ç•¿åœ°æ–¹', hint:'æ´¥å¸‚'},
{name:'æ»‹è³€çœŒ', img:'shiga.png', region:'è¿‘ç•¿åœ°æ–¹', hint:'å¤§æ´¥å¸‚'},
{name:'äº¬éƒ½åºœ', img:'kyoto.png', region:'è¿‘ç•¿åœ°æ–¹', hint:'äº¬éƒ½å¸‚'},
{name:'å¤§é˜ªåºœ', img:'osaka.png', region:'è¿‘ç•¿åœ°æ–¹', hint:'å¤§é˜ªå¸‚'},
{name:'å…µåº«çœŒ', img:'hyogo.png', region:'è¿‘ç•¿åœ°æ–¹', hint:'ç¥æˆ¸å¸‚'},
{name:'å¥ˆè‰¯çœŒ', img:'nara.png', region:'è¿‘ç•¿åœ°æ–¹', hint:'å¥ˆè‰¯å¸‚'},
{name:'å’Œæ­Œå±±çœŒ', img:'wakayama.png', region:'è¿‘ç•¿åœ°æ–¹', hint:'å’Œæ­Œå±±å¸‚'},
{name:'é³¥å–çœŒ', img:'tottori.png', region:'ä¸­å›½åœ°æ–¹', hint:'é³¥å–å¸‚'},
{name:'å³¶æ ¹çœŒ', img:'shimane.png', region:'ä¸­å›½åœ°æ–¹', hint:'æ¾æ±Ÿå¸‚'},
{name:'å²¡å±±çœŒ', img:'okayama.png', region:'ä¸­å›½åœ°æ–¹', hint:'å²¡å±±å¸‚'},
{name:'åºƒå³¶çœŒ', img:'hiroshima.png', region:'ä¸­å›½åœ°æ–¹', hint:'åºƒå³¶å¸‚'},
{name:'å±±å£çœŒ', img:'yamaguchi.png', region:'ä¸­å›½åœ°æ–¹', hint:'å±±å£å¸‚'},
{name:'å¾³å³¶çœŒ', img:'tokushima.png', region:'å››å›½åœ°æ–¹', hint:'å¾³å³¶å¸‚'},
{name:'é¦™å·çœŒ', img:'kagawa.png', region:'å››å›½åœ°æ–¹', hint:'é«˜æ¾å¸‚'},
{name:'æ„›åª›çœŒ', img:'ehime.png', region:'å››å›½åœ°æ–¹', hint:'æ¾å±±å¸‚'},
{name:'é«˜çŸ¥çœŒ', img:'kochi.png', region:'å››å›½åœ°æ–¹', hint:'é«˜çŸ¥å¸‚'},
{name:'ç¦å²¡çœŒ', img:'fukuoka.png', region:'ä¹å·åœ°æ–¹', hint:'ç¦å²¡å¸‚'},
{name:'ä½è³€çœŒ', img:'saga.png', region:'ä¹å·åœ°æ–¹', hint:'ä½è³€å¸‚'},
{name:'é•·å´çœŒ', img:'nagasaki.png', region:'ä¹å·åœ°æ–¹', hint:'é•·å´å¸‚'},
{name:'ç†Šæœ¬çœŒ', img:'kumamoto.png', region:'ä¹å·åœ°æ–¹', hint:'ç†Šæœ¬å¸‚'},
{name:'å¤§åˆ†çœŒ', img:'oita.png', region:'ä¹å·åœ°æ–¹', hint:'å¤§åˆ†å¸‚'},
{name:'å®®å´çœŒ', img:'miyazaki.png', region:'ä¹å·åœ°æ–¹', hint:'å®®å´å¸‚'},
{name:'é¹¿å…å³¶çœŒ', img:'kagoshima.png', region:'ä¹å·åœ°æ–¹', hint:'é¹¿å…å³¶å¸‚'},
{name:'æ²–ç¸„çœŒ', img:'okinawa.png', region:'ä¹å·åœ°æ–¹', hint:'é‚£è¦‡å¸‚'}
];
let remaining=[], currentPref, correctCount=0, wrongCount=0, hintCount=0, totalCount=0;
let regionCorrect={}, regionTotal={};
const prefImg=document.getElementById('prefImg');
const guessInput=document.getElementById('guess');
const resultEl=document.getElementById('result');
const scoreEl=document.getElementById('score');
const hintEl=document.getElementById('hint');

function backToMenu(){
    document.getElementById('modeSelect').style.display='flex';
    document.getElementById('gameArea').style.display='none';
    document.getElementById('resultScreen').style.display='none';
    remaining=[]; currentPref=null; correctCount=0; wrongCount=0; hintCount=0; totalCount=0; regionCorrect={}; regionTotal={};
    prefImg.src=''; guessInput.value=''; resultEl.textContent=''; hintEl.style.display='none'; scoreEl.textContent='';
}
document.getElementById('backBtn').onclick=backToMenu;

function startMode(mode){
    if(mode==='all'){ remaining=[...prefectures]; }
    else remaining=prefectures.filter(p=>{
        if(mode==='tohoku') return p.region==='æ±åŒ—åœ°æ–¹';
        if(mode==='kanto') return p.region==='é–¢æ±åœ°æ–¹';
        if(mode==='chubu') return p.region==='ä¸­éƒ¨åœ°æ–¹';
        if(mode==='kinki') return p.region==='è¿‘ç•¿åœ°æ–¹';
        if(mode==='chugoku') return p.region==='ä¸­å›½åœ°æ–¹';
        if(mode==='shikoku') return p.region==='å››å›½åœ°æ–¹';
        if(mode==='kyushu') return p.region==='ä¹å·åœ°æ–¹';
    });
    correctCount=wrongCount=hintCount=totalCount=0; regionCorrect={}; regionTotal={};
    document.getElementById('modeSelect').style.display='none';
    document.getElementById('resultScreen').style.display='none';
    document.getElementById('gameArea').style.display='flex';
    nextQuestion();
}

function nextQuestion(){
    if(remaining.length===0){ endGame(); return; }
    const idx=Math.floor(Math.random()*remaining.length);
    currentPref=remaining.splice(idx,1)[0];
    regionTotal[currentPref.region]=(regionTotal[currentPref.region]||0)+1;
    prefImg.src=currentPref.img; guessInput.value=''; resultEl.textContent='';
    hintEl.style.display='none';
    scoreEl.textContent=`æ­£è§£ ${correctCount} / ${totalCount}`;
}

document.getElementById('checkBtn').onclick=()=>{
    totalCount++;
    if(guessInput.value.trim()===currentPref.name){
        correctCount++; regionCorrect[currentPref.region]=(regionCorrect[currentPref.region]||0)+1;
        resultEl.textContent='æ­£è§£ï¼ğŸ‰'; resultEl.className='correct';
    } else{
        wrongCount++;
        resultEl.textContent=`ä¸æ­£è§£â€¦ æ­£è§£ã¯ ${currentPref.name}`; resultEl.className='wrong';
    }
    scoreEl.textContent=`æ­£è§£ ${correctCount} / ${totalCount}`;
    setTimeout(nextQuestion,1000);
}

document.getElementById('hintBtn').onclick=()=>{
    hintCount++; hintEl.style.display='flex';
    hintEl.textContent=`çœŒåºæ‰€åœ¨åœ°ï¼š${currentPref.hint}`;
}

function endGame(){
    document.getElementById('gameArea').style.display='none';
    document.getElementById('resultScreen').style.display='flex';
    const date=new Date();
    document.getElementById('date').textContent='ãƒ—ãƒ¬ã‚¤æ—¥: '+date.toLocaleString();
    const finalScore=correctCount*60 - wrongCount*60 - hintCount*30;
    document.getElementById('finalScore').innerHTML=`æœ€çµ‚ã‚¹ã‚³ã‚¢: <b>${finalScore}ç‚¹</b>`;
}

function takeScreenshot(){
    html2canvas(document.getElementById('resultScreen'), {
        backgroundColor: null, // å…ƒã®èƒŒæ™¯ã‚’åæ˜ 
        scale: 2,               // é«˜è§£åƒåº¦ã«ã™ã‚‹
        useCORS: true           // ç”»åƒãŒå¤–éƒ¨ã§ã‚‚æç”»ã§ãã‚‹ã‚ˆã†ã«
    }).then(canvas=>{
        const link=document.createElement('a');
        link.href=canvas.toDataURL('image/png');
        link.download='score.png';
        link.click();
    });
}


function shareOnLINE(){
    const scoreText=document.getElementById('finalScore').innerText;
    const dateText=document.getElementById('date').innerText;
    const gameUrl='https://akkyommm-crypto.github.io/todofuken-game/';
    const message=`ã€éƒ½é“åºœçœŒå½¢å½“ã¦ã‚²ãƒ¼ãƒ ã€‘\n${scoreText}\n${dateText}\n\nã“ã“ã‹ã‚‰éŠã¹ã‚‹ã‚ˆğŸ‘‡\n${gameUrl}`;
    window.open('https://line.me/R/msg/text/?'+encodeURIComponent(message),'_blank');
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«
const regionOrder = ['æ±åŒ—åœ°æ–¹','é–¢æ±åœ°æ–¹','ä¸­éƒ¨åœ°æ–¹','è¿‘ç•¿åœ°æ–¹','ä¸­å›½åœ°æ–¹','å››å›½åœ°æ–¹','ä¹å·åœ°æ–¹'];
function openModal(){
    const tbody=document.getElementById('regionDetails');
    tbody.innerHTML="";
    regionOrder.forEach(region=>{
        const correct = regionCorrect[region] || 0;
        const total = regionTotal[region] || 0;
        const rate = total > 0 ? ((correct/total)*100).toFixed(1) : 0;
        const tr=document.createElement("tr");
        tr.innerHTML=`<td>${region}</td><td>${correct}å•</td><td>${rate}%</td>`;
        tbody.appendChild(tr);
    });
    const modal=document.getElementById('detailModal');
    modal.style.display='flex';
    setTimeout(()=>modal.classList.add('show'),10);
}
function closeModal(){
    const modal=document.getElementById('detailModal');
    modal.classList.remove('show');
    setTimeout(()=>{ modal.style.display='none'; },300);
}

const kanjiPrefectures = [
  {name:"åŒ—æµ·é“", img:"hokkaido.png", options:["åŒ—æµ·é“","åŒ—é™¸é“","åŒ—å³¶é“","åŒ—é“"]},
  {name:"é’æ£®çœŒ", img:"aomori.png", options:["é’æ£®çœŒ","é‘æ£®çœŒ","è’¼æ£®çœŒ","é’æœçœŒ"]},
  {name:"å²©æ‰‹çœŒ", img:"iwate.png", options:["å²©æ‰‹çœŒ","å²©æˆ¸çœŒ","å·Œæ‰‹çœŒ","å²©æ£®çœŒ"]}
  // ä»–ã®éƒ½é“åºœçœŒã‚‚è¿½åŠ å¯èƒ½
];

let kanjiRemaining=[], kanjiCurrent=null;

function startKanjiMode(){
  document.getElementById('modeSelect').style.display='none';
  document.getElementById('gameArea').style.display='none'; // æ—¢å­˜ã‚²ãƒ¼ãƒ éè¡¨ç¤º
  document.getElementById('kanjiModeArea').style.display='flex';
  kanjiRemaining = [...kanjiPrefectures];
  nextKanjiQuestion();
}

function nextKanjiQuestion(){
  if(kanjiRemaining.length===0){
    alert("å…¨å•çµ‚äº†ï¼");
    document.getElementById('kanjiModeArea').style.display='none';
    document.getElementById('modeSelect').style.display='flex';
    return;
  }
  const idx = Math.floor(Math.random()*kanjiRemaining.length);
  kanjiCurrent = kanjiRemaining.splice(idx,1)[0];
  document.getElementById('kanjiPrefImg').src = kanjiCurrent.img;
  document.getElementById('kanjiResult').textContent = "";

  const btnContainer = document.getElementById('kanjiButtons');
  btnContainer.innerHTML = "";
  const shuffledOptions = kanjiCurrent.options.sort(()=>Math.random()-0.5);
  shuffledOptions.forEach(opt=>{
    const btn = document.createElement("button");
    btn.textContent = opt;
    btn.className = "gameButton"; // æ—¢å­˜ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã¨åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«
    btn.onclick = ()=>{
      if(opt === kanjiCurrent.name){
        document.getElementById('kanjiResult').textContent="æ­£è§£ï¼ğŸ‰";
        document.getElementById('kanjiResult').style.color="#0f0";
      } else {
        document.getElementById('kanjiResult').textContent=`ä¸æ­£è§£â€¦ æ­£è§£ã¯ ${kanjiCurrent.name}`;
        document.getElementById('kanjiResult').style.color="#f33";
      }
      setTimeout(nextKanjiQuestion,1000);
    };
    btnContainer.appendChild(btn);
  });
}

document.getElementById('kanjiBackBtn').onclick = ()=>{
  document.getElementById('kanjiModeArea').style.display='none';
  document.getElementById('modeSelect').style.display='flex';
};


</script>
  
</body>
</html>
