<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>éƒ½é“åºœçœŒå½¢å½“ã¦ã‚²ãƒ¼ãƒ ï¼ˆå®Œæˆç‰ˆï¼‰</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
  body {
    font-family: 'Roboto', sans-serif;
    text-align: center;
    margin: 0;
    padding: 20px;
    min-height: 100vh;
    background: linear-gradient(135deg, #1d2671, #c33764);
    color: #fff;
  }
  h2 {
    text-shadow: 2px 2px 6px rgba(0,0,0,0.6);
  }
  button {
    background-color: #ffcc00;
    color: #222;
    border: none;
    border-radius: 12px;
    padding: 14px 24px;
    font-size: 18px;
    margin: 10px auto;
    cursor: pointer;
    transition: all 0.2s;
    display: block;
    width: 100%;
    max-width: 300px;
    box-sizing: border-box;
  }
  button:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px #ffcc00;
  }
  #prefImg {
    width:300px;
    height:300px;
    object-fit:contain;
    border: 3px solid #fff;
    border-radius:12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    margin: 20px auto;
  }
  #hint {
    width:100%; max-width:300px;
    min-height:50px;
    background:#eef;
    color:#222;
    border-radius:8px;
    display:none;
    margin:10px auto;
    padding:10px;
  }
  #result {
    width:100%; max-width:300px;
    min-height:40px;
    margin: 10px auto;
    font-size: 18px;
  }
  input {
    width:100%; max-width:300px;
    padding:12px;
    border-radius:8px;
    border:none;
    margin:10px auto;
    font-size:18px;
    box-sizing:border-box;
  }
  .correct { color: #0f0; font-weight: bold; animation: pop 0.3s; }
  .wrong { color: #f00; font-weight: bold; animation: shake 0.3s; }
  #score {
    margin: 10px auto;
    font-size: 16px;
    white-space: pre-line;
  }
  @keyframes pop {
    0% { transform: scale(0.5); }
    100% { transform: scale(1); }
  }
  @keyframes shake {
    0%,100% { transform: translateX(0); }
    20%,60% { transform: translateX(-5px); }
    40%,80% { transform: translateX(5px); }
  }
  #modeSelect, #gameArea, #resultScreen {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #gameArea, #modeSelect {
    max-width: 350px;
    margin: 0 auto;
  }
  #gameArea {
    background: rgba(255,255,255,0.85);
    border-radius: 16px;
    padding: 20px;
    color: #222;
  }
  #resultScreen {
    max-width: 350px;
    margin: 0 auto;
  }
</style>
</head>
<body>

<div id="modeSelect">
  <h2>ãƒ¢ãƒ¼ãƒ‰ã‚’é¸ã‚“ã§ã­</h2>
  <button onclick="startMode('tohoku')">æ±åŒ—åœ°æ–¹ï¼ˆåŒ—æµ·é“å«ã‚€ï¼‰</button>
  <button onclick="startMode('kanto')">é–¢æ±åœ°æ–¹</button>
  <button onclick="startMode('chubu')">ä¸­éƒ¨åœ°æ–¹</button>
  <button onclick="startMode('kinki')">è¿‘ç•¿åœ°æ–¹</button>
  <button onclick="startMode('chugoku')">ä¸­å›½åœ°æ–¹</button>
  <button onclick="startMode('shikoku')">å››å›½åœ°æ–¹</button>
  <button onclick="startMode('kyushu')">ä¹å·åœ°æ–¹</button>
  <button onclick="startMode('all')">47éƒ½é“åºœçœŒ</button>
</div>

<div id="gameArea" style="display:none;">
  <img id="prefImg" src="" alt="éƒ½é“åºœçœŒã®å½¢">
  <div id="result"></div>
  <input type="text" id="guess" placeholder="éƒ½é“åºœçœŒåã‚’å…¥åŠ›">
  <button id="checkBtn">ç­”ãˆåˆã‚ã›</button>
  <button id="hintBtn">ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹</button>
  <div id="hint"></div>
  <button id="backBtn">ãƒ¢ãƒ¼ãƒ‰é¸æŠã«æˆ»ã‚‹</button>
  <p id="score"></p>
</div>

<div id="resultScreen" style="display:none;">
  <h2>ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ğŸ‰</h2>
  <p id="date"></p>
  <p id="finalScore"></p>
  <p id="finalDetails"></p>
  <button onclick="takeScreenshot()">ğŸ“¸ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ</button>
  <button onclick="shareOnLINE()">ğŸ’¬ LINEã§ã‚·ã‚§ã‚¢</button>
  <button onclick="backToMenu()">ãƒ¢ãƒ¼ãƒ‰é¸æŠã«æˆ»ã‚‹</button>
</div>

<script>
// 47éƒ½é“åºœçœŒãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ’ãƒ³ãƒˆï¼çœŒåºæ‰€åœ¨åœ°ï¼‰
const prefectures = [
{name:'åŒ—æµ·é“', img:'hokkaido.png', region:'æ±åŒ—åœ°æ–¹', hint:'æœ­å¹Œå¸‚'},
{name:'é’æ£®çœŒ', img:'aomori.png', region:'æ±åŒ—åœ°æ–¹', hint:'é’æ£®å¸‚'},
{name:'å²©æ‰‹çœŒ', img:'iwate.png', region:'æ±åŒ—åœ°æ–¹', hint:'ç››å²¡å¸‚'},
{name:'å®®åŸçœŒ', img:'miyagi.png', region:'æ±åŒ—åœ°æ–¹', hint:'ä»™å°å¸‚'},
{name:'ç§‹ç”°çœŒ', img:'akita.png', region:'æ±åŒ—åœ°æ–¹', hint:'ç§‹ç”°å¸‚'},
{name:'å±±å½¢çœŒ', img:'yamagata.png', region:'æ±åŒ—åœ°æ–¹', hint:'å±±å½¢å¸‚'},
{name:'ç¦å³¶çœŒ', img:'fukushima.png', region:'æ±åŒ—åœ°æ–¹', hint:'ç¦å³¶å¸‚'},
{name:'èŒ¨åŸçœŒ', img:'ibaraki.png', region:'é–¢æ±åœ°æ–¹', hint:'æ°´æˆ¸å¸‚'},
{name:'æ ƒæœ¨çœŒ', img:'tochigi.png', region:'é–¢æ±åœ°æ–¹', hint:'å®‡éƒ½å®®å¸‚'},
{name:'ç¾¤é¦¬çœŒ', img:'gunma.png', region:'é–¢æ±åœ°æ–¹', hint:'å‰æ©‹å¸‚'},
{name:'åŸ¼ç‰çœŒ', img:'saitama.png', region:'é–¢æ±åœ°æ–¹', hint:'ã•ã„ãŸã¾å¸‚'},
{name:'åƒè‘‰çœŒ', img:'chiba.png', region:'é–¢æ±åœ°æ–¹', hint:'åƒè‘‰å¸‚'},
{name:'æ±äº¬éƒ½', img:'tokyo.png', region:'é–¢æ±åœ°æ–¹', hint:'æ–°å®¿åŒº'},
{name:'ç¥å¥ˆå·çœŒ', img:'kanagawa.png', region:'é–¢æ±åœ°æ–¹', hint:'æ¨ªæµœå¸‚'},
{name:'æ–°æ½ŸçœŒ', img:'niigata.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'æ–°æ½Ÿå¸‚'},
{name:'å¯Œå±±çœŒ', img:'toyama.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'å¯Œå±±å¸‚'},
{name:'çŸ³å·çœŒ', img:'ishikawa.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'é‡‘æ²¢å¸‚'},
{name:'ç¦äº•çœŒ', img:'fukui.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'ç¦äº•å¸‚'},
{name:'å±±æ¢¨çœŒ', img:'yamanashi.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'ç”²åºœå¸‚'},
{name:'é•·é‡çœŒ', img:'nagano.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'é•·é‡å¸‚'},
{name:'å²é˜œçœŒ', img:'gifu.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'å²é˜œå¸‚'},
{name:'é™å²¡çœŒ', img:'shizuoka.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'é™å²¡å¸‚'},
{name:'æ„›çŸ¥çœŒ', img:'aichi.png', region:'ä¸­éƒ¨åœ°æ–¹', hint:'åå¤å±‹å¸‚'},
{name:'ä¸‰é‡çœŒ', img:'mie.png', region:'è¿‘ç•¿åœ°æ–¹', hint:'æ´¥å¸‚'},
{name:'æ»‹è³€çœŒ', img:'shiga.png', region:'è¿‘ç•¿åœ°æ–¹', hint:'å¤§æ´¥å¸‚'},
{name:'äº¬éƒ½åºœ', img:'kyoto.png', region:'è¿‘ç•¿åœ°æ–¹', hint:'äº¬éƒ½å¸‚'},
{name:'å¤§é˜ªåºœ', img:'osaka.png', region:'è¿‘ç•¿åœ°æ–¹', hint:'å¤§é˜ªå¸‚'},
{name:'å…µåº«çœŒ', img:'hyogo.png', region:'è¿‘ç•¿åœ°æ–¹', hint:'ç¥æˆ¸å¸‚'},
{name:'å¥ˆè‰¯çœŒ', img:'nara.png', region:'è¿‘ç•¿åœ°æ–¹', hint:'å¥ˆè‰¯å¸‚'},
{name:'å’Œæ­Œå±±çœŒ', img:'wakayama.png', region:'è¿‘ç•¿åœ°æ–¹', hint:'å’Œæ­Œå±±å¸‚'},
{name:'é³¥å–çœŒ', img:'tottori.png', region:'ä¸­å›½åœ°æ–¹', hint:'é³¥å–å¸‚'},
{name:'å³¶æ ¹çœŒ', img:'shimane.png', region:'ä¸­å›½åœ°æ–¹', hint:'æ¾æ±Ÿå¸‚'},
{name:'å²¡å±±çœŒ', img:'okayama.png', region:'ä¸­å›½åœ°æ–¹', hint:'å²¡å±±å¸‚'},
{name:'åºƒå³¶çœŒ', img:'hiroshima.png', region:'ä¸­å›½åœ°æ–¹', hint:'åºƒå³¶å¸‚'},
{name:'å±±å£çœŒ', img:'yamaguchi.png', region:'ä¸­å›½åœ°æ–¹', hint:'å±±å£å¸‚'},
{name:'å¾³å³¶çœŒ', img:'tokushima.png', region:'å››å›½åœ°æ–¹', hint:'å¾³å³¶å¸‚'},
{name:'é¦™å·çœŒ', img:'kagawa.png', region:'å››å›½åœ°æ–¹', hint:'é«˜æ¾å¸‚'},
{name:'æ„›åª›çœŒ', img:'ehime.png', region:'å››å›½åœ°æ–¹', hint:'æ¾å±±å¸‚'},
{name:'é«˜çŸ¥çœŒ', img:'kochi.png', region:'å››å›½åœ°æ–¹', hint:'é«˜çŸ¥å¸‚'},
{name:'ç¦å²¡çœŒ', img:'fukuoka.png', region:'ä¹å·åœ°æ–¹', hint:'ç¦å²¡å¸‚'},
{name:'ä½è³€çœŒ', img:'saga.png', region:'ä¹å·åœ°æ–¹', hint:'ä½è³€å¸‚'},
{name:'é•·å´çœŒ', img:'nagasaki.png', region:'ä¹å·åœ°æ–¹', hint:'é•·å´å¸‚'},
{name:'ç†Šæœ¬çœŒ', img:'kumamoto.png', region:'ä¹å·åœ°æ–¹', hint:'ç†Šæœ¬å¸‚'},
{name:'å¤§åˆ†çœŒ', img:'oita.png', region:'ä¹å·åœ°æ–¹', hint:'å¤§åˆ†å¸‚'},
{name:'å®®å´çœŒ', img:'miyazaki.png', region:'ä¹å·åœ°æ–¹', hint:'å®®å´å¸‚'},
{name:'é¹¿å…å³¶çœŒ', img:'kagoshima.png', region:'ä¹å·åœ°æ–¹', hint:'é¹¿å…å³¶å¸‚'},
{name:'æ²–ç¸„çœŒ', img:'okinawa.png', region:'ä¹å·åœ°æ–¹', hint:'é‚£è¦‡å¸‚'}
];

let remaining = [], currentPref, correctCount=0, wrongCount=0, hintCount=0, totalCount=0;
let regionCorrect = {};
const prefImg = document.getElementById('prefImg');
const guessInput = document.getElementById('guess');
const resultEl = document.getElementById('result');
const scoreEl = document.getElementById('score');
const hintEl = document.getElementById('hint');

function startMode(mode){
  if(mode==='all'){
    remaining = [...prefectures]; }
  else {
    remaining = prefectures.filter(p => {
      if(mode==='tohoku') return p.region==='æ±åŒ—åœ°æ–¹';
      if(mode==='kanto') return p.region==='é–¢æ±åœ°æ–¹';
      if(mode==='chubu') return p.region==='ä¸­éƒ¨åœ°æ–¹';
      if(mode==='kinki') return p.region==='è¿‘ç•¿åœ°æ–¹';
      if(mode==='chugoku') return p.region==='ä¸­å›½åœ°æ–¹';
      if(mode==='shikoku') return p.region==='å››å›½åœ°æ–¹';
      if(mode==='kyushu') return p.region==='ä¹å·åœ°æ–¹';
    });
  }
  correctCount = wrongCount = hintCount = totalCount = 0;
  regionCorrect = {};
  document.getElementById('modeSelect').style.display = 'none';
  document.getElementById('resultScreen').style.display = 'none';
  document.getElementById('gameArea').style.display = 'flex';
  nextQuestion();
}

function nextQuestion(){
  if(remaining.length === 0){ endGame(); return; }
  const idx = Math.floor(Math.random()*remaining.length);
  currentPref = remaining.splice(idx,1)[0];
  prefImg.src = currentPref.img;
  guessInput.value = '';
  resultEl.textContent = '';
  hintEl.style.display = 'none';
  scoreEl.textContent = `æ­£è§£ ${correctCount} / ${totalCount}`;
}

document.getElementById('checkBtn').onclick = () => {
  totalCount++;
  if(guessInput.value.trim() === currentPref.name){
    correctCount++;
    regionCorrect[currentPref.region] = (regionCorrect[currentPref.region]||0)+1;
    resultEl.textContent = 'æ­£è§£ï¼ğŸ‰'; resultEl.className='correct';
  } else {
    wrongCount++;
    resultEl.textContent = `ä¸æ­£è§£â€¦ æ­£è§£ã¯ ${currentPref.name}`; resultEl.className='wrong';
  }
  scoreEl.textContent = `æ­£è§£ ${correctCount} / ${totalCount}`;
  setTimeout(nextQuestion,1000);
};

document.getElementById('hintBtn').onclick = () => {
  hintCount++;
  hintEl.style.display = 'flex';
  hintEl.textContent = `çœŒåºæ‰€åœ¨åœ°ï¼š${currentPref.hint}`;
};

function endGame(){
  document.getElementById('gameArea').style.display = 'none';
  document.getElementById('resultScreen').style.display = 'flex';

  const date = new Date();
  document.getElementById('date').textContent = 'ãƒ—ãƒ¬ã‚¤æ—¥: '+date.toLocaleString();
  document.getElementById('finalScore').innerHTML = `æœ€çµ‚ã‚¹ã‚³ã‚¢: <b>${correctCount*60 - wrongCount*60 - hintCount*30}ç‚¹</b>`;

  let detail = `æ­£è§£: ${correctCount}å• / ä¸æ­£è§£: ${wrongCount}å• / ãƒ’ãƒ³ãƒˆ: ${hintCount}å›\n`;
  for(const region in regionCorrect){
    detail += `${region}: ${regionCorrect[region]}å•\n`;
  }
  document.getElementById('finalDetails').innerHTML = detail;

  scoreEl.textContent = '';
}

function takeScreenshot(){
  html2canvas(document.getElementById('resultScreen')).then(canvas => {
    const link = document.createElement('a');
    link.href = canvas.toDataURL('image/png');
    link.download = 'score.png';
    link.click();
  });
}

function shareOnLINE(){
  const scoreText = document.getElementById('finalScore').innerText;
  const detailsText = document.getElementById('finalDetails').innerText;
  const dateText = document.getElementById('date').innerText;
  const gameUrl = 'https://akkyommm-crypto.github.io/todofuken-game/';

  const message = `ã€éƒ½é“åºœçœŒå½¢å½“ã¦ã‚²ãƒ¼ãƒ ã€‘\n${scoreText}\n${detailsText}\n${dateText}\n\nã“ã“ã‹ã‚‰éŠã¹ã‚‹ã‚ˆğŸ‘‡\n${gameUrl}`;
  window.open('https://line.me/R/msg/text/?' + encodeURIComponent(message), '_blank');
}

document.getElementById('backBtn').onclick = () => { document.getElementById('modeSelect').style.display='flex'; document.getElementById('resultScreen').style.display='none'; };

</script>
</body>
</html>
