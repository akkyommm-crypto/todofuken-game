<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>都道府県形当てゲーム</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
body {
  font-family:'Roboto',sans-serif;
  text-align:center;
  margin:0;
  padding:20px;
  min-height:100vh;
  background: linear-gradient(135deg,#56ccf2,#2f80ed);
  color:#fff;
}
h2 { text-shadow:2px 2px 6px rgba(0,0,0,0.3); }
button {
  background-color:#ffe066;
  color:#222;
  border:none;
  border-radius:12px;
  padding:14px 24px;
  font-size:18px;
  margin:10px auto;
  cursor:pointer;
  transition:all 0.2s;
  display:block;
  width:100%;
  max-width:300px;
  box-sizing:border-box;
}
button:hover { transform:scale(1.05); box-shadow:0 0 15px #ffe066; }
#prefImg { width:300px; height:300px; object-fit:contain; border:3px solid #fff; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.2); margin:20px auto; }
#hint { width:100%; max-width:300px; min-height:50px; background:#fff; color:#222; border-radius:8px; display:none; margin:10px auto; padding:10px; font-weight:bold; }
#result { width:100%; max-width:300px; min-height:40px; margin:10px auto; font-size:18px; font-weight:bold; }
input { width:100%; max-width:300px; padding:12px; border-radius:8px; border:none; margin:10px auto; font-size:18px; box-sizing:border-box; }
.correct { color:#0f0; animation:pop 0.3s; }
.wrong { color:#ff3b3b; animation:shake 0.3s; }
#score { margin:10px auto; font-size:16px; white-space: pre-line; font-weight:bold; }

@keyframes pop { 0%{transform:scale(0.5);} 100%{transform:scale(1);} }
@keyframes shake { 0%,100%{transform:translateX(0);} 20%,60%{transform:translateX(-5px);} 40%,80%{transform:translateX(5px);} }

#modeSelect,#gameArea,#resultScreen { display:flex; flex-direction:column; align-items:center; }
#gameArea,#modeSelect { max-width:350px; margin:0 auto; }
#gameArea { background:rgba(255,255,255,0.85); border-radius:16px; padding:20px; color:#222; }
#resultScreen { max-width:350px; margin:0 auto; color:#fff; }

/* モーダル */
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; opacity:0; transition: opacity 0.3s ease; }
.modal.show { display:flex; opacity:1; }
.modal-content { background:#fff; color:#222; padding:20px; border-radius:12px; max-width:450px; width:90%; text-align:center; box-shadow:0 5px 20px rgba(0,0,0,0.3); transform: translateY(-30px); transition: transform 0.3s ease; }
.modal.show .modal-content { transform: translateY(0); }
#regionTable { width:100%; border-collapse:collapse; margin-top:15px; }
#regionTable th, #regionTable td { border:1px solid #ccc; padding:8px; }
#regionTable th { background:#f0f0f0; }
</style>
</head>
<body>

<div id="modeSelect">
  <h2>モードを選んでね</h2>
  <button onclick="startMode('tohoku')">東北地方（北海道含む）</button>
  <button onclick="startMode('kanto')">関東地方</button>
  <button onclick="startMode('chubu')">中部地方</button>
  <button onclick="startMode('kinki')">近畿地方</button>
  <button onclick="startMode('chugoku')">中国地方</button>
  <button onclick="startMode('shikoku')">四国地方</button>
  <button onclick="startMode('kyushu')">九州地方</button>
  <button onclick="startMode('all')">47都道府県</button>
  <button onclick="startKanjiMode()">漢字4択モード</button>
</div>

<div id="gameArea" style="display:none;">
  <img id="prefImg" src="" alt="都道府県の形">
  <div id="result"></div>
  <input type="text" id="guess" placeholder="都道府県名を入力">
  <button id="checkBtn">答え合わせ</button>
  <button id="hintBtn">ヒントを見る</button>
  <div id="hint"></div>
  <button id="backBtn">モード選択に戻る</button>
  <p id="score"></p>
</div>

<div id="resultScreen" style="display:none;">
  <h2>お疲れ様でした！🎉</h2>
  <p id="date"></p>
  <p id="finalScore"></p>
  <button onclick="openModal()">📊 地方別正解を見る</button>
  <button onclick="takeScreenshot()">📸 スクリーンショット</button>
  <button onclick="shareOnLINE()">💬 LINEでシェア</button>
  <button onclick="backToMenu()">⬅️ モード選択に戻る</button>
</div>

<!-- モーダル -->
<div id="detailModal" class="modal">
  <div class="modal-content">
    <h3>地方別の正解数</h3>
    <table id="regionTable">
      <thead>
        <tr><th>地方</th><th>正解数</th><th>正解率</th></tr>
      </thead>
      <tbody id="regionDetails"></tbody>
    </table>
    <button onclick="closeModal()">閉じる</button>
  </div>
</div>

 <!-- 漢字４択 -->
<div id="kanjiModeArea" class="gameAreaStyle" style="display:none;">
  <img id="kanjiPrefImg" class="gameImage" src="" alt="都道府県の形">

  <div id="kanjiButtons" style="width:100%; display:flex; flex-direction:column; gap:10px; margin:10px 0;"></div>

  <div id="kanjiResult" style="min-height:40px; font-size:18px; font-weight:bold; margin:10px 0;"></div>

  <button id="kanjiBackBtn" class="gameButton">モード選択に戻る</button>
</div>
  
<script>
// 都道府県データ（47都道府県サンプル）
const prefectures=[
{name:'北海道', img:'hokkaido.png', region:'東北地方', hint:'札幌市'},
{name:'青森県', img:'aomori.png', region:'東北地方', hint:'青森市'},
{name:'岩手県', img:'iwate.png', region:'東北地方', hint:'盛岡市'},
{name:'宮城県', img:'miyagi.png', region:'東北地方', hint:'仙台市'},
{name:'秋田県', img:'akita.png', region:'東北地方', hint:'秋田市'},
{name:'山形県', img:'yamagata.png', region:'東北地方', hint:'山形市'},
{name:'福島県', img:'fukushima.png', region:'東北地方', hint:'福島市'},
{name:'茨城県', img:'ibaraki.png', region:'関東地方', hint:'水戸市'},
{name:'栃木県', img:'tochigi.png', region:'関東地方', hint:'宇都宮市'},
{name:'群馬県', img:'gunma.png', region:'関東地方', hint:'前橋市'},
{name:'埼玉県', img:'saitama.png', region:'関東地方', hint:'さいたま市'},
{name:'千葉県', img:'chiba.png', region:'関東地方', hint:'千葉市'},
{name:'東京都', img:'tokyo.png', region:'関東地方', hint:'新宿区'},
{name:'神奈川県', img:'kanagawa.png', region:'関東地方', hint:'横浜市'},
{name:'新潟県', img:'niigata.png', region:'中部地方', hint:'新潟市'},
{name:'富山県', img:'toyama.png', region:'中部地方', hint:'富山市'},
{name:'石川県', img:'ishikawa.png', region:'中部地方', hint:'金沢市'},
{name:'福井県', img:'fukui.png', region:'中部地方', hint:'福井市'},
{name:'山梨県', img:'yamanashi.png', region:'中部地方', hint:'甲府市'},
{name:'長野県', img:'nagano.png', region:'中部地方', hint:'長野市'},
{name:'岐阜県', img:'gifu.png', region:'中部地方', hint:'岐阜市'},
{name:'静岡県', img:'shizuoka.png', region:'中部地方', hint:'静岡市'},
{name:'愛知県', img:'aichi.png', region:'中部地方', hint:'名古屋市'},
{name:'三重県', img:'mie.png', region:'近畿地方', hint:'津市'},
{name:'滋賀県', img:'shiga.png', region:'近畿地方', hint:'大津市'},
{name:'京都府', img:'kyoto.png', region:'近畿地方', hint:'京都市'},
{name:'大阪府', img:'osaka.png', region:'近畿地方', hint:'大阪市'},
{name:'兵庫県', img:'hyogo.png', region:'近畿地方', hint:'神戸市'},
{name:'奈良県', img:'nara.png', region:'近畿地方', hint:'奈良市'},
{name:'和歌山県', img:'wakayama.png', region:'近畿地方', hint:'和歌山市'},
{name:'鳥取県', img:'tottori.png', region:'中国地方', hint:'鳥取市'},
{name:'島根県', img:'shimane.png', region:'中国地方', hint:'松江市'},
{name:'岡山県', img:'okayama.png', region:'中国地方', hint:'岡山市'},
{name:'広島県', img:'hiroshima.png', region:'中国地方', hint:'広島市'},
{name:'山口県', img:'yamaguchi.png', region:'中国地方', hint:'山口市'},
{name:'徳島県', img:'tokushima.png', region:'四国地方', hint:'徳島市'},
{name:'香川県', img:'kagawa.png', region:'四国地方', hint:'高松市'},
{name:'愛媛県', img:'ehime.png', region:'四国地方', hint:'松山市'},
{name:'高知県', img:'kochi.png', region:'四国地方', hint:'高知市'},
{name:'福岡県', img:'fukuoka.png', region:'九州地方', hint:'福岡市'},
{name:'佐賀県', img:'saga.png', region:'九州地方', hint:'佐賀市'},
{name:'長崎県', img:'nagasaki.png', region:'九州地方', hint:'長崎市'},
{name:'熊本県', img:'kumamoto.png', region:'九州地方', hint:'熊本市'},
{name:'大分県', img:'oita.png', region:'九州地方', hint:'大分市'},
{name:'宮崎県', img:'miyazaki.png', region:'九州地方', hint:'宮崎市'},
{name:'鹿児島県', img:'kagoshima.png', region:'九州地方', hint:'鹿児島市'},
{name:'沖縄県', img:'okinawa.png', region:'九州地方', hint:'那覇市'}
];
let remaining=[], currentPref, correctCount=0, wrongCount=0, hintCount=0, totalCount=0;
let regionCorrect={}, regionTotal={};
const prefImg=document.getElementById('prefImg');
const guessInput=document.getElementById('guess');
const resultEl=document.getElementById('result');
const scoreEl=document.getElementById('score');
const hintEl=document.getElementById('hint');

function backToMenu(){
    document.getElementById('modeSelect').style.display='flex';
    document.getElementById('gameArea').style.display='none';
    document.getElementById('resultScreen').style.display='none';
    remaining=[]; currentPref=null; correctCount=0; wrongCount=0; hintCount=0; totalCount=0; regionCorrect={}; regionTotal={};
    prefImg.src=''; guessInput.value=''; resultEl.textContent=''; hintEl.style.display='none'; scoreEl.textContent='';
}
document.getElementById('backBtn').onclick=backToMenu;

function startMode(mode){
    if(mode==='all'){ remaining=[...prefectures]; }
    else remaining=prefectures.filter(p=>{
        if(mode==='tohoku') return p.region==='東北地方';
        if(mode==='kanto') return p.region==='関東地方';
        if(mode==='chubu') return p.region==='中部地方';
        if(mode==='kinki') return p.region==='近畿地方';
        if(mode==='chugoku') return p.region==='中国地方';
        if(mode==='shikoku') return p.region==='四国地方';
        if(mode==='kyushu') return p.region==='九州地方';
    });
    correctCount=wrongCount=hintCount=totalCount=0; regionCorrect={}; regionTotal={};
    document.getElementById('modeSelect').style.display='none';
    document.getElementById('resultScreen').style.display='none';
    document.getElementById('gameArea').style.display='flex';
    nextQuestion();
}

function nextQuestion(){
    if(remaining.length===0){ endGame(); return; }
    const idx=Math.floor(Math.random()*remaining.length);
    currentPref=remaining.splice(idx,1)[0];
    regionTotal[currentPref.region]=(regionTotal[currentPref.region]||0)+1;
    prefImg.src=currentPref.img; guessInput.value=''; resultEl.textContent='';
    hintEl.style.display='none';
    scoreEl.textContent=`正解 ${correctCount} / ${totalCount}`;
}

document.getElementById('checkBtn').onclick=()=>{
    totalCount++;
    if(guessInput.value.trim()===currentPref.name){
        correctCount++; regionCorrect[currentPref.region]=(regionCorrect[currentPref.region]||0)+1;
        resultEl.textContent='正解！🎉'; resultEl.className='correct';
    } else{
        wrongCount++;
        resultEl.textContent=`不正解… 正解は ${currentPref.name}`; resultEl.className='wrong';
    }
    scoreEl.textContent=`正解 ${correctCount} / ${totalCount}`;
    setTimeout(nextQuestion,1000);
}

document.getElementById('hintBtn').onclick=()=>{
    hintCount++; hintEl.style.display='flex';
    hintEl.textContent=`県庁所在地：${currentPref.hint}`;
}

function endGame(){
    document.getElementById('gameArea').style.display='none';
    document.getElementById('resultScreen').style.display='flex';
    const date=new Date();
    document.getElementById('date').textContent='プレイ日: '+date.toLocaleString();
    const finalScore=correctCount*60 - wrongCount*60 - hintCount*30;
    document.getElementById('finalScore').innerHTML=`最終スコア: <b>${finalScore}点</b>`;
}

function takeScreenshot(){
    html2canvas(document.getElementById('resultScreen'), {
        backgroundColor: null, // 元の背景を反映
        scale: 2,               // 高解像度にする
        useCORS: true           // 画像が外部でも描画できるように
    }).then(canvas=>{
        const link=document.createElement('a');
        link.href=canvas.toDataURL('image/png');
        link.download='score.png';
        link.click();
    });
}


function shareOnLINE(){
    const scoreText=document.getElementById('finalScore').innerText;
    const dateText=document.getElementById('date').innerText;
    const gameUrl='https://akkyommm-crypto.github.io/todofuken-game/';
    const message=`【都道府県形当てゲーム】\n${scoreText}\n${dateText}\n\nここから遊べるよ👇\n${gameUrl}`;
    window.open('https://line.me/R/msg/text/?'+encodeURIComponent(message),'_blank');
}

// モーダル
const regionOrder = ['東北地方','関東地方','中部地方','近畿地方','中国地方','四国地方','九州地方'];
function openModal(){
    const tbody=document.getElementById('regionDetails');
    tbody.innerHTML="";
    regionOrder.forEach(region=>{
        const correct = regionCorrect[region] || 0;
        const total = regionTotal[region] || 0;
        const rate = total > 0 ? ((correct/total)*100).toFixed(1) : 0;
        const tr=document.createElement("tr");
        tr.innerHTML=`<td>${region}</td><td>${correct}問</td><td>${rate}%</td>`;
        tbody.appendChild(tr);
    });
    const modal=document.getElementById('detailModal');
    modal.style.display='flex';
    setTimeout(()=>modal.classList.add('show'),10);
}
function closeModal(){
    const modal=document.getElementById('detailModal');
    modal.classList.remove('show');
    setTimeout(()=>{ modal.style.display='none'; },300);
}

const kanjiPrefectures = [
  {name:"北海道", img:"hokkaido.png", options:["北海道","北陸道","北島道","北道"]},
  {name:"青森県", img:"aomori.png", options:["青森県","靑森県","蒼森県","青杜県"]},
  {name:"岩手県", img:"iwate.png", options:["岩手県","岩戸県","巌手県","岩森県"]}
  // 他の都道府県も追加可能
];

let kanjiRemaining=[], kanjiCurrent=null;

function startKanjiMode(){
  document.getElementById('modeSelect').style.display='none';
  document.getElementById('gameArea').style.display='none'; // 既存ゲーム非表示
  document.getElementById('kanjiModeArea').style.display='flex';
  kanjiRemaining = [...kanjiPrefectures];
  nextKanjiQuestion();
}

function nextKanjiQuestion(){
  if(kanjiRemaining.length===0){
    alert("全問終了！");
    document.getElementById('kanjiModeArea').style.display='none';
    document.getElementById('modeSelect').style.display='flex';
    return;
  }
  const idx = Math.floor(Math.random()*kanjiRemaining.length);
  kanjiCurrent = kanjiRemaining.splice(idx,1)[0];
  document.getElementById('kanjiPrefImg').src = kanjiCurrent.img;
  document.getElementById('kanjiResult').textContent = "";

  const btnContainer = document.getElementById('kanjiButtons');
  btnContainer.innerHTML = "";
  const shuffledOptions = kanjiCurrent.options.sort(()=>Math.random()-0.5);
  shuffledOptions.forEach(opt=>{
    const btn = document.createElement("button");
    btn.textContent = opt;
    btn.className = "gameButton"; // 既存ゲームボタンと同じスタイル
    btn.onclick = ()=>{
      if(opt === kanjiCurrent.name){
        document.getElementById('kanjiResult').textContent="正解！🎉";
        document.getElementById('kanjiResult').style.color="#0f0";
      } else {
        document.getElementById('kanjiResult').textContent=`不正解… 正解は ${kanjiCurrent.name}`;
        document.getElementById('kanjiResult').style.color="#f33";
      }
      setTimeout(nextKanjiQuestion,1000);
    };
    btnContainer.appendChild(btn);
  });
}

document.getElementById('kanjiBackBtn').onclick = ()=>{
  document.getElementById('kanjiModeArea').style.display='none';
  document.getElementById('modeSelect').style.display='flex';
};


</script>
  
</body>
</html>
