<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>都道府県当てゲーム</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body { font-family: sans-serif; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; }
    #map { width:100%; height:300px; margin:10px 0; }
    .choices { display:grid; grid-template-columns:1fr 1fr; gap:8px; width:90%; max-width:400px; }
    .choices button { padding:12px; border-radius:8px; border:1px solid #ccc; font-size:16px; }
    .correct { background:#c8facc; border-color:#38a169; }
    .wrong { background:#fbb; border-color:#e53e3e; }
  </style>
</head>
<body>
  <h2>都道府県の形を当てよう！</h2>
  <div id="map"></div>
  <div class="choices" id="choices"></div>
  <p id="result"></p>
  <button id="nextBtn">次へ</button>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([37.5,137], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      { attribution: '&copy; OpenStreetMap contributors' }).addTo(map);

    let geojsonData;
    let currentPref;
    let layer;
    const choicesEl = document.getElementById('choices');
    const resultEl = document.getElementById('result');
    const nextBtn = document.getElementById('nextBtn');

    async function loadData(){
      const res = await fetch('https://raw.githubusercontent.com/geolonia/japan-geojson/master/municipality/japan.geojson');
      geojsonData = await res.json();
      startQuestion();
    }

    function startQuestion(){
      const features = geojsonData.features.filter(f=>f.properties.N03_001);
      currentPref = features[Math.floor(Math.random()*features.length)];

      if(layer) map.removeLayer(layer);
      layer = L.geoJSON(currentPref, {style:{color:"#333",fillColor:"#3b82f6",fillOpacity:0.6}}).addTo(map);
      map.fitBounds(layer.getBounds());

      const allPrefs = [...new Set(features.map(f=>f.properties.N03_001))];
      const correct = currentPref.properties.N03_001;
      const choices = new Set([correct]);
      while(choices.size<4){
        choices.add(allPrefs[Math.floor(Math.random()*allPrefs.length)]);
      }
      const choiceArr = [...choices].sort(()=>Math.random()-0.5);

      choicesEl.innerHTML="";
      choiceArr.forEach(pref=>{
        const btn=document.createElement("button");
        btn.textContent=pref;
        btn.onclick=()=>checkAnswer(pref,correct,btn);
        choicesEl.appendChild(btn);
      });
      resultEl.textContent="";
    }

    function checkAnswer(pref,correct,btn){
      const buttons = choicesEl.querySelectorAll("button");
      buttons.forEach(b=>b.disabled=true);
      if(pref===correct){
        btn.classList.add("correct");
        resultEl.textContent="正解！";
      }else{
        btn.classList.add("wrong");
        resultEl.textContent=`不正解！ 正解は ${correct}`;
        buttons.forEach(b=>{ if(b.textContent===correct) b.classList.add("correct"); });
      }
    }

    nextBtn.onclick=startQuestion;
    loadData();
  </script>
</body>
</html>
